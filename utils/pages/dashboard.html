<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/src/output.css">
</head>
<style>
    html {
        background-color: rgb(89, 255, 71, 0.2);
    }
</style>
<body>
    <header>
        <nav id="nav-bar" class="bg-green-300 p-5 
        flex flex-col items-center gap-4
        md:flex-row items-center justify-between
        ">
            <h1 id="nav-name">Budgetr - Dashboard</h1>
            <div id="sign-out-container">
                <button id="sign-out-btn" class="p-2">Sign Out</button>
            </div>
        </nav>
    </header>
    <main class="
        flex flex-col items-center
        lg:grid grid-cols-3 gap-2 p-5
        ">
        <!--Column One-->
        <div id="content-row-one" class="content-row 
            flex flex-col items-start gap-2 w-full
            lg: m-auto
            ">
            <h2>
                Expenses
            </h2>
            <label for="budget-input">
                Budget:
                <input type="number" id="budget-input">
            </label>

            <label for="expense-name-field">
                Expense:
                <input type="text" id="expense-name-field" maxlength="25">
            </label>
            <label for="expense-cost-field">
                Cost:
                <input type="number" id="expense-cost-field">
            </label>
            <button id="add-expense-btn">Add</button>
            <button id="save-expense-btn">Save</button>

            <p id="expense-budget">Budget: </p>
            <p id="budget-remainder">Remainder: </p>

            <p id="error-display" class="hidden">TEST</p>
        </div>
        <!--Column Two-->

        <div id="content-row-two" class="content-row flex flex-col gap-4 
            w-full
            lg: m-auto
            ">

        </div>
        <!--Column Three-->
        <div id="content-row-three" class="content-row
            w-full      
            lg: m-auto
        ">
            <h2>Expenses Summary</h2>
            <div id="chart-container">
                <canvas id="myChart"></canvas>
            </div>
        </div>   
    </main>
</body>
</html>
<script type="module" src="../expenseFunctions.js"></script>
<script type="module" src="../budgetFunctions.js"></script>
<!--Import Chart.js-->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<!--Render Expense Data-->
<script type="module">
    import { getBudget } from "/src/firebaseConfig.js"


    let budget = await getBudget()

    let labels = getLabels()
    let costs = getCosts()



    function getLabels () {
        if (budget) {
            let expenseArray = budget.userBudget.expenses
            let tempLabels = []
            for (let i = 0; i < expenseArray.length; i++) {
                tempLabels.push(
                    expenseArray[i].label
                )
            }
            return tempLabels
        }
    }

    function getCosts () {
        let expenseArray = budget.userBudget.expenses
        if (budget) {
            let tempCosts = []
            for (let i = 0; i < expenseArray.length; i++) {
                tempCosts.push(
                    expenseArray[i].cost
                )
            }
            return tempCosts
        }
    }



    
    const ctx = document.getElementById('myChart');

   const data = {
    labels: labels,
    datasets: [{
        data: costs,
        backgroundColor: [
        'rgb(255, 99, 132)',
        'rgb(54, 162, 235)',
        'rgb(255, 205, 86)'
        ],
        hoverOffset: 4
    }]
    };

    new Chart(ctx, {
    type: "pie",
    data: data
    });
</script>
<script type="module">
    import { handleGoogleSignOut } from "/src/firebaseConfig.js"

    document.getElementById("sign-out-btn").addEventListener("click", (event) => {
        event.preventDefault()
        handleGoogleSignOut()
    })
</script>
